# äººå·¥æ™ºèƒ½ã®æœºå™¨å­¦ä¹ day_2

[TOC]

## æ•°æ®é›†ä»‹ç»ä¸åˆ’åˆ†

### æ•°æ®é›†çš„åˆ’åˆ†

æœºå™¨å­¦ä¹ ä¸€èˆ¬çš„æ•°æ®é›†ä¼šåˆ’åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š

* è®­ç»ƒé›†ï¼šç”¨äºè®­ç»ƒã€æ„å»ºæ¨¡å‹
* æµ‹è¯•é›†ï¼šåœ¨æ¨¡å‹æ£€éªŒæ—¶ä½¿ç”¨ï¼Œç”¨äºè¯„ä¼°æ¨¡å‹æ˜¯å¦æœ‰æ•ˆ

åˆ’åˆ†æ¯”ä¾‹ï¼š

* è®­ç»ƒé›†ï¼š70%ã€80%ã€75%
* æµ‹è¯•é›†ï¼š30%ã€20%ã€25%

### API

* `sklearn.model_selection.train_test_split(arrarys, *options)`
  * x æ•°æ®é›†çš„ç‰¹å¾å€¼
  * y æ•°æ®é›†çš„ç›®æ ‡å€¼ï¼ˆæ ‡ç­¾ï¼‰
  * test_size æµ‹è¯•é›†çš„å¤§å°ï¼Œä¸€èˆ¬ä¸ºfloat
  * random_state éšæœºæ•°ç§å­ï¼Œä¸åŒçš„ç§å­ä¼šé€ æˆä¸åŒçš„éšæœºé‡‡æ ·ç»“æœã€‚ç›¸åŒçš„ç§å­é‡‡æ ·ç»“æœç›¸åŒã€‚
  * returnï¼Œè®­ç»ƒé›†ç‰¹å¾å€¼ï¼Œæµ‹è¯•é›†ç‰¹å¾å€¼ï¼Œè®­ç»ƒæ ‡ç­¾ï¼Œæµ‹è¯•æ ‡ç­¾ï¼ˆé»˜è®¤å€¼éšæœºå–ï¼‰

## sklearnæ•°æ®é›†ä»‹ç»

### API

* `sklearn.datasets`
  * åŠ è½½è·å–æµè¡Œæ•°æ®é›†
  * `datasets.load_*()`
    * è·å–å°è§„æ¨¡æ•°æ®é›† `*` ï¼Œæ•°æ®åŒ…å«åœ¨`datasets`é‡Œ
  * `datasets.fetch_*(data_home=None)`
    * è·å–å¤§è§„æ¨¡æ•°æ®é›†`*`ï¼Œéœ€è¦ä»ç½‘ç»œä¸Šä¸‹è½½ï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯`data_home`ï¼Œè¡¨ç¤ºæ•°æ®é›†ä¸‹è½½çš„ç›®å½•ï¼Œé»˜è®¤æ˜¯`~/scikit_learn_data/`

### åˆ†ç±»å’Œå›å½’æ•°æ®é›†

* **åˆ†ç±»æ•°æ®é›†**
  `sklearn.datasets.load_iris()`åŠ è½½å¹¶è¿”å›é¸¢å°¾èŠ±æ•°æ®é›†
  `sklearn.datasets.load_digits()`åŠ è½½å¹¶è¿”å›æ•°å­—æ•°æ®é›†

  * `sklearn.datasets.fetch_20newsgroups(data_home=None, subset='train')`
    *   subsetï¼š`train`æˆ–è€…`test`ï¼Œ`all`ï¼Œå¯é€‰ï¼Œé€‰æ‹©è¦åŠ è½½çš„æ•°æ®é›†ã€‚å³è®­ç»ƒé›†çš„â€œè®­ç»ƒâ€ï¼Œæµ‹è¯•é›†çš„â€œæµ‹è¯•â€ï¼Œä¸¤è€…çš„â€œå…¨éƒ¨â€ã€‚

* **å›å½’æ•°æ®é›†**

  `sklearn.datasets.load_boston()`åŠ è½½å¹¶è¿”å›æ³¢å£«é¡¿æˆ¿ä»·æ•°æ®é›†

  `sklearn.datasets.load_diabetes()`åŠ è½½å¹¶è¿”å›ç³–å°¿ç—…æ•°æ®é›†

### è¿”å›ç±»å‹

* `load`å’Œ`fetch`è¿”å›çš„æ•°æ®ç±»å‹`datasets.base.Bunch(å­—å…¸æ ¼å¼)`
  * `data`ï¼šç‰¹å¾æ•°æ®æ•°ç»„ï¼Œæ˜¯`[n_samples * n_features]`çš„äºŒç»´`numpy.ndarray`æ•°ç»„
  * `target`ï¼šæ ‡ç­¾æ•°ç»„ï¼Œæ˜¯`n_samples`çš„ä»¥ä¸º`numpy.ndarray`æ•°ç»„
  * `DESCR`ï¼šæ•°æ®æè¿°
  * `feature_names`ï¼šç‰¹å¾åï¼Œæ–°é—»æ•°æ®ï¼Œæ‰‹å†™æ•°ç»„ã€å›å½’æ•°æ®é›†
  * `target_names`ï¼šæ ‡ç­¾å

## sklearnçš„è½¬æ¢å™¨å’Œä¼°è®¡å™¨

### è½¬æ¢å™¨

æƒ³ä¸€ä¸‹ä¹‹å‰åšçš„ç‰¹å¾å·¥ç¨‹çš„æ­¥éª¤ï¼š

* 1.å®ä¾‹åŒ–ï¼ˆå®ä¾‹åŒ–ä¸€ä¸ªè½¬æ¢å™¨ç±»ï¼ˆTransformerï¼‰ï¼‰
* 2.è°ƒç”¨fit_transformï¼ˆå¯¹äºæ–‡æ¡£å»ºç«‹åˆ†ç±»è¯é¢‘çŸ©é˜µï¼Œä¸èƒ½åŒæ—¶è°ƒç”¨ï¼‰

æˆ‘ä»¬æŠŠç‰¹å¾å·¥ç¨‹çš„æ¥å£ç§°ä¹‹ä¸ºè½¬æ¢å™¨ï¼Œå…¶ä¸­è½¬æ¢å™¨è°ƒç”¨æœ‰è¿™ä¹ˆå‡ ç§å½¢å¼ï¼ˆä»¥æ ‡å‡†åŒ–ä¸ºä¾‹ï¼‰

* fit_transform(a)ï¼šç›¸å½“äº fit + transform ä»¥aè‡ªå·±çš„å¹³å‡å€¼æ ‡å‡†å·®è½¬æ¢è‡ªå·±
* fit(a)ï¼šè®¡ç®—açš„å¹³å‡å€¼æ ‡å‡†å·®
* transform(b)ï¼šç”¨açš„å¹³å‡å€¼æ ‡å‡†å·®å»è½¬æ¢b

è¿™ä¸ªæ³•åˆ™é€‚ç”¨äºç‰¹å¾é€‰æ‹©ã€ä¸»æˆåˆ†åˆ†æã€ç‰¹å¾æŠ½å– 

å¯ä»¥é€šè¿‡ipythonæ¥è§‚å¯Ÿä»–ä»¬ä¹‹é—´çš„åŒºåˆ«ï¼š
![imageaa509.png](https://miao.su/images/2019/07/04/imageaa509.png)

### ä¼°è®¡å™¨ï¼ˆestimatorï¼‰

*sklearn æœºå™¨å­¦ä¹ ç®—æ³•çš„å®ç°*
åœ¨sklearnä¸­ï¼Œä¼°è®¡å™¨ï¼ˆestimatorï¼‰æ˜¯ä¸€ä¸ªé‡è¦è§’è‰²ï¼Œæ˜¯ä¸€ç±»å®ç°äº†ç®—æ³•çš„APIã€‚

1. ç”¨äºåˆ†ç±»çš„ä¼°è®¡å™¨ï¼š
   * `sklearn.neighbors k`â€”â€”è¿‘é‚»ç®—æ³•
   * `sklearn.naive_bayes`â€”â€”è´å¶æ–¯
   * `sklearn.linear_model.LogisticRegression`â€”â€”é€»è¾‘å›å½’
   * `sklearn.tree`â€”â€”å†³ç­–æ ‘ä¸éšæœºæ£®æ—
2. ç”¨äºå›å½’çš„ä¼°è®¡å™¨ï¼š
   * `sklearn.linear_model.LinearRegression`â€”â€”çº¿æ€§å›å½’
   * `sklearn.linear_model.Ridge`â€”â€”å²­å›å½’
3. ç”¨äºæ— ç›‘ç£å­¦ä¹ çš„ä¼°è®¡å™¨
   * `sklearn.cluster.KMeans`â€”â€”èšç±»

### ä¼°è®¡å™¨å·¥ä½œæµç¨‹

![image02e37.png](https://miao.su/images/2019/07/04/image02e37.png)

* fit()ï¼šè®­ç»ƒé›†è®­ç»ƒ
* æµ‹è¯•é›†é¢„æµ‹ï¼špredictã€score

![image6b8d9.png](https://miao.su/images/2019/07/04/image6b8d9.png)



## K-è¿‘é‚»ç®—æ³•ï¼ˆKNNï¼‰

### å®šä¹‰

å¦‚æœä¸€ä¸ªæ ·æœ¬åœ¨ç‰¹å¾ç©ºé—´ä¸­çš„**kä¸ªæœ€ç›¸ä¼¼ï¼ˆå³ç‰¹å¾ç©ºé—´ä¸­æœ€é‚»è¿‘ï¼‰çš„æ ·æœ¬ä¸­çš„å¤§å¤šæ•°å±äºæŸä¸€ä¸ªç±»åˆ«**ï¼Œåˆ™è¯¥æ ·æœ¬ä¹Ÿå±äºè¿™ä¸ªç±»åˆ«ã€‚

> æ¥æºï¼šKNNç®—æ³•æœ€æ—©æ˜¯ç”±Coverå’ŒHartæå‡ºçš„ä¸€ç§åˆ†ç±»ç®—æ³•

### è·ç¦»å…¬å¼

ä¸¤ä¸ªæ ·æœ¬çš„è·ç¦»å¯ä»¥é€šè¿‡å¦‚ä¸‹å…¬å¼è®¡ç®—ï¼Œä¹Ÿç§°æ¬§å¼è·ç¦»ï¼ˆç©ºé—´ä¸¤ç‚¹çš„è·ç¦»å…¬å¼ï¼‰
	$ç‚¹x(a_1,b_1,c_1)å’Œç‚¹y(a_2,b_2,c_2)çš„è·ç¦»å…¬å¼ï¼š$
$$
\sqrt[]{(a_1-a_2)^2 + (b_1-b_2)^2 + (c_1-c_2)^2}
$$

### ç”µå½±ç±»å‹åˆ†æ

å‡è®¾æˆ‘ä»¬æœ‰é™åˆ¶å‡ éƒ¨ç”µå½±ï¼š
![imageb34be.png](https://miao.su/images/2019/07/04/imageb34be.png)
å…¶ä¸­`?`ç”µå½±ä¸çŸ¥é“ç±»åˆ«ï¼Œå¦‚ä½•å»é¢„æµ‹ï¼Ÿæˆ‘ä»¬å¯ä»¥åˆ©ç”¨k-è¿‘é‚»ç®—æ³•çš„æ€æƒ³ã€‚
![image78963.png](https://miao.su/images/2019/07/04/image78963.png)

### é—®é¢˜

* å¦‚æœè·ç¦»æœ€è¿‘çš„ç”µå½±æ•°é‡ä¸æ­¢ä¸€ä¸ªï¼Ÿ

### K-è¿‘é‚»ç®—æ³•API

* `sklearn.neighbors.KNeighborsClassifier(n_neighbours=5, algorithm='auto')`
  * `n_neighbors:int,å¯é€‰ï¼ˆé»˜è®¤=5ï¼‰, k_neighborsæŸ¥è¯¢é»˜è®¤ä½¿ç”¨çš„é‚»å±…æ•°`
  * `algorithm:{'auto','ball_tree','kd_tree','brute'}`ï¼Œå¯é€‰ç”¨äºè®¡ç®—æœ€è¿‘é‚»å±…çš„ç®—æ³•ï¼š`ball_tree`å°†ä¼šä½¿ç”¨`BallTree`ï¼Œ`kd_tree`å°†ä½¿ç”¨`KDTree`ã€‚`auto`å°†å°è¯•æ ¹æ®ä¼ é€’ç»™`fit`æ–¹æ³•çš„å€¼æ¥å†³å®šæœ€åˆé€‚çš„ç®—æ³•ã€‚ï¼ˆä¸åŒçš„å®ç°æ–¹æ³•å½±å“æ•ˆç‡ï¼‰ã€‚

### æ¡ˆä¾‹ï¼šé¢„æµ‹ç­¾åˆ°ä½ç½®

![image252ac.png](https://miao.su/images/2019/07/04/image252ac.png)

æ•°æ®ä»‹ç»ï¼š

```python
train.csv, test.csv
row_id: ç™»è®°äº‹ä»¶çš„ID
xy: åæ ‡
å‡†ç¡®æ€§: å®šä½å‡†ç¡®æ€§
æ—¶é—´: æ—¶é—´æˆ³
place_id: ä¸šåŠ¡çš„IDï¼Œè¿™æ˜¯ä½ è¦é¢„æµ‹çš„ç›®æ ‡
```



#### åˆ†æ

* å¯¹äºæ•°æ®åšä¸€äº›ä¸€äº›åŸºæœ¬å¤„ç†ï¼ˆè¿™é‡Œæ‰€åšçš„ä¸€äº›å¤„ç†ä¸ä¸€å®šè¾¾åˆ°å¾ˆå¥½çš„æ•ˆæœï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•çš„å°è¯•ï¼Œæœ‰äº›ç‰¹å¾æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸€äº›ç‰¹å¾é€‰æ‹©çš„æ–¹å¼å»å¤„ç†ï¼‰

  1. ç¼©å°æ•°æ®é›†èŒƒå›´	DataFrame.query()

  2. åˆ é™¤æ²¡ç”¨çš„æ—¥æœŸæ•°æ®     DataFrame.dropï¼ˆå¯ä»¥é€‰æ‹©ä¿ç•™ï¼‰

  3. å°†ç­¾åˆ°ä½ç½®å°‘äºnä¸ªç”¨æˆ·çš„ä¿¡æ¯åˆ é™¤

     ```python
     place_count = data.groupby('place_id').count()
     tf = place_count[place_count.row_id > 3].reset_index()
     data = data[data['place_id'].isoin(tf.place_id)]
     ```

* åˆ†å‰²æ•°æ®é›†

* æ ‡å‡†åŒ–å¤„ç†

* k-è¿‘é‚»é¢„æµ‹

**K-è¿‘é‚»ç®—æ³•çš„ä¸€èˆ¬æµç¨‹**

1. æ”¶é›†æ•°æ®ï¼šå¯ä»¥ä½¿ç”¨ä»»ä½•æ–¹æ³•
2. å‡†å¤‡æ•°æ®ï¼šè·ç¦»è®¡ç®—æ‰€éœ€è¦çš„æ•°å€¼ï¼Œæœ€å¥½æ˜¯ç»“æ„åŒ–çš„æ•°æ®æ ¼å¼
3. åˆ†ææ•°æ®ï¼šå¯ä»¥ä½¿ç”¨ä»»ä½•æ–¹æ³•
4. è®­ç»ƒç®—æ³•ï¼šæ­¤æ­¥éª¤ä¸é€‚åˆäºK-è¿‘é‚»ç®—æ³•
5. æµ‹è¯•ç®—æ³•ï¼šè®¡ç®—é”™è¯¯ç‡
6. ä½¿ç”¨ç®—æ³•ï¼šé¦–é€‰éœ€è¦è¾“å…¥æ ·æœ¬æ•°æ®å’Œç»“æ„åŒ–çš„è¾“å‡ºç»“æœï¼Œç„¶åè¿è¡ŒK-è¿‘é‚»ç®—æ³•åˆ¤å®šè¾“å…¥æ•°æ®åˆ†åˆ«å±äºå“ªä¸ªåˆ†ç±»ï¼Œæœ€ååº”ç”¨å¯¹è®¡ç®—å‡ºçš„åˆ†ç±»æ‰§è¡Œåç»­çš„å¤„ç†ã€‚

#### ä»£ç 

```python
  8 def knncls():
  9     """K-è¿‘é‚»ç®—æ³•é¢„æµ‹ç”¨æˆ·æŸ¥è¯¢ä¸šåŠ¡"""
 10     data = pd.read_csv('/home/jhonchen/scikit_learn_data/FBlocation/train_0.csv')
 11     # print(data)
 12     # 1.ç¼©å°æ•°æ®èŒƒå›´
 13     # data = data.query("x >1.0 & x < 1.25 & y > 2.5 & y< 2.75")
 14     # å–å‡ºç‰¹å¾å€¼å’Œç›®æ ‡å€¼
 15     y = data[['place_id']]
 16 
 17     x = data[['x', 'y', 'accuracy', 'time']]
 18     x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3)
 19     # è¿›è¡Œæ•°æ®çš„æ ‡å‡†åŒ–å¤„ç†
 20     # å®ä¾‹åŒ–
 21     std = StandardScaler()
 22     # å¯¹è®­ç»ƒé›†çš„ç‰¹å¾å€¼åšæ ‡å‡†åŒ–å¤„ç†
 23     x_train = std.fit_transform(x_train)
 24     # å¯¹æµ‹è¯•é›†çš„ç‰¹å¾å€¼åšæ ‡å‡†åŒ–å¤„ç†
 25     x_test = std.fit_transform(x_test)
 26 
 29     # 5.åˆ©ç”¨k-è¿‘é‚»ç®—æ³•å»è¿›è¡Œè®­ç»ƒé¢„æµ‹
 30     knn = KNeighborsClassifier(n_neighbors=5)
 31     # è°ƒç”¨fitå’Œpredictæˆ–è€…score
 32     knn.fit(x_train, y_train)
 33     # é¢„æµ‹æµ‹è¯•é›†çš„ç›®æ ‡å€¼ï¼ˆç­¾åˆ°ä½ç½®ï¼‰
 34     y_predict = knn.predict(x_test)
 35 
 36     print("Kè¿‘é‚»ç®—æ³•é¢„æµ‹çš„è¿™äº›æ—¶é—´çš„ä¸šåŠ¡ç±»å‹ï¼š", y_predict)
 37     print("Kè¿‘é‚»é¢„æµ‹çš„å‡†ç¡®ç‡ï¼š", knn.score(x_test, y_test))
 38     return None
 
 41 if __name__ == '__main__':
 42     knncls()
```

#### ç»“æœåˆ†æ

**å‡†ç¡®ç‡ï¼šåˆ†ç±»ç®—æ³•çš„è¯„ä¼°ä¹‹ä¸€**

1. kå€¼å–å¤šå¤§ï¼Ÿæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ
   kå€¼å–çš„å¾ˆå°ï¼šå®¹æ˜“å—åˆ°å¼‚å¸¸ç‚¹çš„å½±å“
   kå€¼å–çš„å¾ˆå¤§ï¼šä¼šå—åˆ°æ ·æœ¬å‡è¡¡çš„é—®é¢˜
2. æ€§èƒ½é—®é¢˜ï¼Ÿ
   è·ç¦»è®¡ç®—ä¸Šé¢ï¼Œæ—¶é—´å¤æ‚åº¦é«˜

### æ€»ç»“

* ä¼˜ç‚¹ï¼š
  ç®€å•ã€æ˜“äºç†è§£ã€æ˜“äºå®ç°ã€æ— éœ€è®­ç»ƒ
* ç¼ºç‚¹ï¼š
  æ‡’æƒ°ç®—æ³•ã€å¯¹æµ‹è¯•æ ·æœ¬åˆ†ç±»æ—¶çš„è®¡ç®—é‡å¤§ã€å†…å­˜å¼€é”€å¤§
  å¿…é¡»æŒ‡å®škå€¼ï¼Œkå€¼é€‰æ‹©ä¸å½“åˆ™åˆ†ç±»ç²¾åº¦ä¸èƒ½ä¿è¯
* ä½¿ç”¨åœºæ™¯ï¼š
  å°æ•°æ®åœºæ™¯ï¼Œå‡ åƒ~å‡ åƒä¸‡æ ·æœ¬ï¼Œå…·ä½“åœºæ™¯å…·ä½“ä¸šåŠ¡å»æµ‹è¯•



## æ¨¡å‹çš„é€‰æ‹©ä¸è°ƒä¼˜

### ä¸ºä»€ä¹ˆè¦äº¤å‰éªŒè¯

äº¤å‰éªŒè¯çš„ç›®çš„ï¼šä¸ºäº†è®©è¢«è¯„ä¼°çš„æ¨¡å‹æ›´åŠ å‡†ç¡®å¯ä¿¡ï¼Œä¸ºäº†çœ‹ä¸€ä¸ªå‚æ•°åœ¨è¿™ä¸ªæ•°æ®é›†å½“ä¸­ç»¼åˆè¡¨ç°æƒ…å†µ

### ä»€ä¹ˆæ˜¯äº¤å‰éªŒè¯(cross validation)

äº¤å‰éªŒè¯ï¼šå°†æ‹¿åˆ°çš„**è®­ç»ƒæ•°æ®**(å’Œæµ‹è¯•é›†æ— å…³)ï¼Œåˆ†ä¸º**è®­ç»ƒé›†**å’Œ**éªŒè¯é›†**ã€‚ä»¥ä¸‹å›¾ä¸ºä¾‹ï¼šå°†æ•°æ®åˆ†ä¸º5ä»½ï¼Œå…¶ä¸­ä¸€ä»½ä½œä¸ºéªŒè¯é›†ã€‚ç„¶åç»è¿‡5æ¬¡ï¼ˆç»„ï¼‰çš„æµ‹è¯•ï¼Œæ¯æ¬¡éƒ½æ›´æ¢ä¸åŒçš„éªŒè¯é›†ã€‚å³å¾—åˆ°5ç»„æ¨¡å‹çš„ç»“æœï¼Œå–å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆç»“æœã€‚åˆç§°**5æŠ˜äº¤å‰éªŒè¯**ã€‚(é€šå¸¸æƒ…å†µåŠ ä¸‹é‡‡å–åæŠ˜éªŒè¯)
![imagedaa05.png](https://miao.su/images/2019/07/05/imagedaa05.png)

é—®é¢˜ï¼šé‚£ä¹ˆè¿™ä¸ªåªæ˜¯å¯¹äºå‚æ•°å¾—å‡ºæ›´å¥½çš„ç»“æœï¼Œé‚£ä¹ˆæ€ä¹ˆé€‰æ‹©æˆ–è€…è°ƒä¼˜å‚æ•°å‘¢ï¼Ÿ

### è¶…å‚æ•°æœç´¢-ç½‘æ ¼æœç´¢(Grid Search)

é€šå¸¸æƒ…å†µä¸‹ï¼Œæœ‰å¾ˆå¤šå‚æ•°æ˜¯éœ€è¦**æ‰‹åŠ¨æŒ‡å®š**çš„(**å¦‚k-è¿‘é‚»ç®—æ³•ä¸­çš„kå€¼**)ï¼Œè¿™ç§å«åš**è¶…å‚æ•°**ã€‚ä½†æ˜¯æ‰‹åŠ¨è¿‡ç¨‹ç¹æ‚ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ¨¡å‹é¢„è®¾å‡ ç§è¶…å‚æ•°ç»„åˆã€‚**æ¯ç»„è¶…å‚æ•°éƒ½é‡‡ç”¨äº¤å‰éªŒè¯æ¥è¿›è¡Œè¯„ä¼°ã€‚æœ€åé€‰å‡ºæœ€ä¼˜å‚æ•°ç»„åˆå»ºç«‹æ¨¡å‹ã€‚**
![image7eab3.png](https://miao.su/images/2019/07/05/image7eab3.png)

### æ¨¡å‹é€‰æ‹©ä¸è°ƒä¼˜

* `sklearn.model_selection.GridSearchCV(estimator, param_grid=None, cv=None)`

  * å¯¹ä¼°è®¡å™¨çš„æŒ‡å®šå‚æ•°å€¼è¿›è¡Œè¯¦å°½æœç´¢
  * `estimator`ï¼šä¼°è®¡å™¨å¯¹è±¡
  * `param_grid`ï¼šä¼°è®¡å™¨å‚æ•°`(dict){"n_neighbors":[1, 3, 5]}`
  * `cv`ï¼šæŒ‡å®šå‡ æŠ˜äº¤å‰éªŒè¯

  è¿”å›ç»“æœï¼š

  * `fit`ï¼šè¾“å…¥è®­ç»ƒæ•°æ®
  * `score`ï¼šå‡†ç¡®ç‡
  * ç»“æœåˆ†æï¼š
    * `best_score_`ï¼šåœ¨äº¤å‰éªŒè¯ä¸­éªŒè¯çš„æœ€å¥½ç»“æœ
    * `beste_stmator_`ï¼šæœ€å¥½çš„å‚æ•°æ¨¡å‹
    * `cv_results_`ï¼šæ¯æ¬¡äº¤å‰éªŒè¯åçš„éªŒè¯é›†å‡†ç¡®ç‡ç»“æœå’Œè®­ç»ƒé›†å‡†ç¡®ç‡ç»“æœ



## æœ´ç´ è´å¶æ–¯ç®—æ³•

### ä»€ä¹ˆæ˜¯æœ´ç´ è´å¶æ–¯ç®—æ³•ï¼Ÿ

![imagebf36b.png](https://miao.su/images/2019/07/06/imagebf36b.png)
![image42c54.png](https://miao.su/images/2019/07/06/image42c54.png)

### æ¦‚ç‡åŸºç¡€

#### æ¦‚ç‡å®šä¹‰

$P(x)[0,1]$

#### å¼•ä¾‹ï¼š

![imagec6f6a.png](https://miao.su/images/2019/07/06/imagec6f6a.png)
![imagebf04f.png](https://miao.su/images/2019/07/06/imagebf04f.png)

#### æ¡ä»¶æ¦‚ç‡å’Œè”åˆæ¦‚ç‡

- è”åˆæ¦‚ç‡ï¼šåŒ…å«å¤šä¸ªæ¡ä»¶ï¼Œä¸”æ‰€æœ‰æ¡ä»¶åŒæ—¶æˆç«‹çš„æ¦‚ç‡
  - è®°ä½œï¼šP(A,B)
  - ç‰¹æ€§ï¼šP(A, B) = P(A)P(B)
- æ¡ä»¶æ¦‚ç‡ï¼šå°±æ˜¯äº‹ä»¶Aåœ¨å¦å¤–ä¸€ä¸ªäº‹ä»¶Bå·²ç»å‘ç”Ÿæ¡ä»¶ä¸‹çš„å‘ç”Ÿæ¦‚ç‡
  - è®°ä½œï¼šP(A|B)
  - ç‰¹æ€§ï¼šP(A1, A2|B) = P(A1|B)P(A2|B)

> æ³¨æ„ï¼šæ­¤æ¡ä»¶æ¦‚ç‡çš„æˆç«‹ï¼Œ**æ˜¯ç”±äºA1,A2ç›¸äº’ç‹¬ç«‹çš„ç»“æœ**(è®°å¿†)

è¿™æ ·æˆ‘ä»¬è®¡ç®—ç»“æœä¸ºï¼š

```python
p(ç¨‹åºå‘˜, åŒ€ç§°) =  P(ç¨‹åºå‘˜)P(åŒ€ç§°) =3/7*(4/7) = 12/49 
P(äº§å“, è¶…é‡|å–œæ¬¢) = P(äº§å“|å–œæ¬¢)P(è¶…é‡|å–œæ¬¢)=1/2 *  1/4 = 1/8
```

**é‚£ä¹ˆï¼Œæˆ‘ä»¬çŸ¥é“äº†è¿™äº›çŸ¥è¯†ä¹‹åï¼Œç»§ç»­å›åˆ°æˆ‘ä»¬çš„ä¸»é¢˜ä¸­ã€‚æœ´ç´ è´å¶æ–¯å¦‚ä½•åˆ†ç±»ï¼Œè¿™ä¸ªç®—æ³•ç»å¸¸ä¼šç”¨åœ¨æ–‡æœ¬åˆ†ç±»ï¼Œé‚£å°±æ¥çœ‹æ–‡ç« åˆ†ç±»æ˜¯ä¸€ä¸ªä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Ÿ**
$$
P(ç§‘æŠ€|æ–‡ç« )ï¼ŒP(å¨±ä¹|æ–‡ç« )
$$

### è´å¶æ–¯å…¬å¼

$$
P(C|W)=\frac{P(W|C)P(C)}{P(W)}
$$

*æ³¨ï¼šWä¸ºç»™å®šæ–‡æ¡£çš„ç‰¹å¾å€¼ï¼ˆé¢‘æ•°ç»Ÿè®¡ï¼Œé¢„æµ‹æ–‡æ¡£æä¾›ï¼‰ï¼Œ Cä¸ºæ–‡æ¡£ç±»åˆ«*

**é‚£ä¹ˆè¿™ä¸ªå…¬å¼å¦‚æœåº”ç”¨åœ¨æ–‡ç« åˆ†ç±»çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·çœ‹ï¼š**
å…¬å¼å¯ä»¥ç†è§£ä¸ºï¼š
$$
P(C|F1,F2,...)=\frac{P(F1,F2,...|C)P(C)}{P(F1,F2,...)}
$$
å…¶ä¸­Cå¯ä»¥æ˜¯ä¸åŒçš„ç±»åˆ«ã€‚å…¬å¼åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š

- P(C)ï¼šæ¯ä¸ªæ–‡æ¡£ç±»åˆ«çš„æ¦‚ç‡(æŸæ–‡æ¡£ç±»åˆ«æ•°ï¼æ€»æ–‡æ¡£æ•°é‡)
- P(Wâ”‚C)ï¼šç»™å®šç±»åˆ«ä¸‹ç‰¹å¾ï¼ˆè¢«é¢„æµ‹æ–‡æ¡£ä¸­å‡ºç°çš„è¯ï¼‰çš„æ¦‚ç‡
  - è®¡ç®—æ–¹æ³•ï¼šP(F1â”‚C)=Ni/N ï¼ˆè®­ç»ƒæ–‡æ¡£ä¸­å»è®¡ç®—ï¼‰
    - Niä¸ºè¯¥F1è¯åœ¨Cç±»åˆ«æ‰€æœ‰æ–‡æ¡£ä¸­å‡ºç°çš„æ¬¡æ•°
    - Nä¸ºæ‰€å±ç±»åˆ«Cä¸‹çš„æ–‡æ¡£æ‰€æœ‰è¯å‡ºç°çš„æ¬¡æ•°å’Œ
- P(F1,F2,â€¦) é¢„æµ‹æ–‡æ¡£ä¸­æ¯ä¸ªè¯çš„æ¦‚ç‡

#### æ–‡ç« åˆ†ç±»è®¡ç®—

* å‡è®¾æˆ‘ä»¬ä»**è®­ç»ƒæ•°æ®é›†**çš„åˆ°å¦‚ä¸‹ä¿¡æ¯

![imagedde2b.png](https://miao.su/images/2019/07/06/imagedde2b.png)

* è®¡ç®—ç»“æœ

  ```python
  ç§‘æŠ€ï¼šP(ç§‘æŠ€|å½±é™¢,æ”¯ä»˜å®,äº‘è®¡ç®—) = ğ‘ƒ(å½±é™¢,æ”¯ä»˜å®,äº‘è®¡ç®—|ç§‘æŠ€)âˆ—P(ç§‘æŠ€)=(8/100)âˆ—(20/100)âˆ—(63/100)âˆ—(30/90) = 0.00456109
  
  å¨±ä¹ï¼šP(å¨±ä¹|å½±é™¢,æ”¯ä»˜å®,äº‘è®¡ç®—) = ğ‘ƒ(å½±é™¢,æ”¯ä»˜å®,äº‘è®¡ç®—|å¨±ä¹)âˆ—P(å¨±ä¹)=(56/121)âˆ—(15/121)âˆ—(0/121)âˆ—(60/90) = 0
  ```

*æ€è€ƒï¼šæˆ‘ä»¬è®¡ç®—å‡ºæŸä¸ªç»“æœä¸ºé›¶ï¼Œåˆé€‚ä¹ˆï¼Ÿ*

#### æ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ç³»æ•°

ç›®çš„ï¼šé˜²æ­¢è®¡ç®—å‡ºçš„åˆ†ç±»æ¦‚ç‡ä¸º0
$$
P(F_1|C)=\frac{N_i+\alpha}{N+\alpha m}
$$
$\alpha$ä¸ºæŒ‡å®šçš„ç³»æ•°ï¼Œä¸€èˆ¬ä¸º1ï¼Œ$m$ä¸ºè®­ç»ƒæ–‡æ¡£ä¸­ç»Ÿè®¡å‡ºçš„**ç‰¹å¾è¯**çš„ä¸ªæ•°

```python
P(å¨±ä¹|å½±é™¢,æ”¯ä»˜å®,äº‘è®¡ç®—) =P(å½±é™¢,æ”¯ä»˜å®,äº‘è®¡ç®—|å¨±ä¹)P(å¨±ä¹) =P(å½±é™¢|å¨±ä¹)*P(æ”¯ä»˜å®|å¨±ä¹)*P(äº‘è®¡ç®—|å¨±ä¹)P(å¨±ä¹)=(56+1/121+4)(15+1/121+4)(0+1/121+1*4)(60/90) = 0.00002
```

#### API

* `sklearn.naive_bayes.MultinomiaNB(alpha = 1.0)`
  * æœ´ç´ è´å¶æ–¯åˆ†ç±»
  * `alpha`ï¼šæ‹‰æ™®æ‹‰æ–¯å¹³æ»‘ç³»æ•°

### æ¡ˆä¾‹ï¼š20ç±»æ–°é—»åˆ†ç±»

![image7845a.png](https://miao.su/images/2019/07/06/image7845a.png)

#### åˆ†æ

* åˆ†éš”æ•°æ®é›†
* tfidfè¿›è¡Œçš„ç‰¹å¾æŠ½å–
* æœ´ç´ è´å¶æ–¯é¢„æµ‹

#### ä»£ç 

```python
  1 #!/usr/bin/env python
  2 # coding=utf-8
  3 from sklearn.feature_extraction.text import CountVectorizer, TfidfVectorizer
  4 from sklearn.feature_extraction import DictVectorizer
  5 from sklearn.preprocessing import StandardScaler
  6 from sklearn.datasets import fetch_20newsgroups
  7 from sklearn.naive_bayes import MultinomialNB
  8 from sklearn.model_selection import train_test_split, GridSearchCV
  9 import pandas as pd
 10 
 11 
 12 def nbcls():
 13     """æœ´ç´ è´å¶æ–¯å¯¹20ç±»æ–°é—»è¿›è¡Œåˆ†ç±»"""
 14     news = fetch_20newsgroups(subset="all")
 15     # print(news)
 16 
 17     # 1.åˆ†å‰²æ•°æ®é›†
 18     x_train, x_test, y_train, y_test = train_test_split(news.data, news.target, test_size=0.3)
 19 
 20     # 2.è¿›è¡Œæ–‡æœ¬ç‰¹å¾æŠ½å–ï¼Œè®©ç®—æ³•èƒ½å¤ŸçŸ¥é“ç‰¹å¾å€¼
 21     # å®ä¾‹åŒ–tfidf
 22     tfidf = TfidfVectorizer()
 23     # å¯¹è®­ç»ƒé›†ç‰¹å¾æŠ½å–
 24     x_train = tfidf.fit_transform(x_train)
 25     # å¯¹æµ‹è¯•é›†ç‰¹å¾æŠ½å–
 26     # æ³¨æ„ï¼Œæ­¤å¤„ä¸å†æ˜¯fit_transformï¼Œå› æˆ‘ä»¬æ˜¯æ ¹æ®è®­ç»ƒé›†ç»Ÿè®¡å‡ºçš„ç‰¹å¾æ¥é¢„æµ‹æµ‹è¯•é›†
 27     x_test = tfidf.transform(x_test)
 28 
 29     # è¿›è¡Œæœ´ç´ è´å¶æ–¯ç®—æ³•é¢„æµ‹
 30     mlb = MultinomialNB(alpha=1.0)
 31     mlb.fit(x_train, y_train)
 32     # é¢„æµ‹ï¼Œå‡†ç¡®ç‡
 33     print("é¢„æµ‹æµ‹è¯•é›†å½“ä¸­çš„æ–‡æ¡£ç±»åˆ«æ˜¯:", mlb.predict(x_test)[:50])
 34     print("æµ‹è¯•é›†å½“ä¸­çš„æ–‡æ¡£çœŸå®ç±»åˆ«æ˜¯:", y_test[:50])
 35 
 36     # å¾—å‡ºå‡†ç¡®ç‡
 37     print("æ–‡æ¡£åˆ†ç±»çš„å‡†ç¡®ç‡ä¸º:", mlb.score(x_test, y_test))
 38 
 39 
 40     return None 
 41 
 42 
 43 
 44 if __name__ == '__main__':
 45     nbcls()
```

#### æ€»ç»“

* ä¼˜ç‚¹ï¼š
  * æœ´ç´ è´å¶æ–¯æ¨¡å‹å‘æºäºå¤å…¸æ•°å­¦ç†è®ºï¼Œæœ‰ç¨³å®šçš„åˆ†ç±»æ•ˆç‡ï¼ˆå¤å…¸æ¦‚å‹ï¼‰
  * å¯¹ç¼ºå¤±æ•°æ®ä¸å¤ªæ•æ„Ÿï¼Œç®—æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œå¸¸ç”¨äºæ–‡æœ¬åˆ†ç±»
  * åˆ†ç±»å‡†ç¡®åº¦é«˜ã€é€Ÿåº¦å¿«
* ç¼ºç‚¹ï¼š
  * ç”±äºä½¿ç”¨äº†æ ·æœ¬å±æ€§ç‹¬ç«‹æ€§çš„å‡è®¾ï¼Œæ‰€ä»¥å¦‚æœç‰¹å¾å±æ€§æœ‰å…³è”æ—¶å…¶æ•ˆæœä¸å¥½ï¼ˆå³äº‹ä»¶ç›¸äº’ç‹¬ç«‹ï¼‰



## å†³ç­–æ ‘

### è®¤è¯†å†³ç­–æ ‘

å†³ç­–æ ‘æ€æƒ³çš„æ¥æºéå¸¸æœ´ç´ ï¼Œç¨‹åºè®¾è®¡ä¸­çš„æ¡ä»¶åˆ†æ”¯ç»“æ„å°±æ˜¯`if-then`ç»“æ„ï¼Œæœ€æ—©çš„å†³ç­–æ ‘å°±æ˜¯åˆ©ç”¨è¿™ç±»ç»“æ„åˆ†éš”æ•°æ®çš„ä¸€ç§åˆ†ç±»å­¦ä¹ æ–¹æ³• ã€‚

å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä¾‹å­æ¥ç†è§£ï¼š
![image03c6b.png](https://miao.su/images/2019/07/06/image03c6b.png)

### å†³ç­–æ ‘åˆ†ç±»åŸç†è¯¦è§£

ä¸ºäº†æ›´å¥½çš„ç†è§£å†³ç­–æ ‘å…·ä½“æ€ä¹ˆåˆ†ç±»çš„ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªé—®é¢˜ä¾‹å­ï¼š
![imageb30c7.png](https://miao.su/images/2019/07/06/imageb30c7.png)

å¯èƒ½ä½ çš„åˆ’åˆ†æ˜¯è¿™æ ·çš„ï¼š
![image981a5.png](https://miao.su/images/2019/07/06/image981a5.png)

çœŸæ­£çš„å†³ç­–æ ‘æ˜¯è¿™æ ·åˆ’åˆ†çš„ï¼š
![image751de.png](https://miao.su/images/2019/07/06/image751de.png)

### åŸç†

* ä¿¡æ¯ç†µã€ä¿¡æ¯å¢ç›Šç­‰
* éœ€è¦ç”¨åˆ°ä¿¡æ¯è®ºçš„çŸ¥è¯†

**å†³ç­–æ ‘çš„ä¸€èˆ¬æµç¨‹**

1. æ”¶é›†æ•°æ®ï¼šå¯ä»¥ä½¿ç”¨ä»»ä½•æ–¹æ³•
2. å‡†å¤‡æ•°æ®ï¼šæ ‘æ„é€ ç®—æ³•åªé€‚ç”¨äºæ ‡ç§°å‹æ•°æ®ï¼Œå› æ­¤æ•°å€¼å‹æ•°æ®å¿…é¡»ç¦»æ•£åŒ–
3. åˆ†ææ•°æ®ï¼šå¯ä»¥ä½¿ç”¨ä»»ä½•æ–¹æ³•ï¼Œæ„é€ æ ‘å®Œæˆä¹‹åï¼Œæˆ‘ä»¬åº”è¯¥æ£€æŸ¥å›¾å½¢æ˜¯å¦ç¬¦åˆé¢„æœŸ
4. è®­ç»ƒç®—æ³•ï¼šæ„é€ æ ‘çš„æ•°æ®ç»“æ„
5. æµ‹è¯•ç®—æ³•ï¼šä½¿ç”¨ç»éªŒæ ‘è®¡ç®—é”™è¯¯ç‡
6. ä½¿ç”¨ç®—æ³•ï¼šæ­¤æ­¥éª¤å¯ä»¥é€‚ç”¨äºä»»ä½•ç›‘ç£å­¦ä¹ ç®—æ³•ï¼Œè€Œä½¿ç”¨å†³ç­–æ ‘å¯ä»¥æ›´å¥½åœ°ç†è§£æ•°æ®çš„å†…åœ¨å«ä¹‰



### ä¿¡æ¯ç†µ

é‚£æ¥ç©ä¸ªçŒœæµ‹æ¸¸æˆï¼ŒçŒœçŒœè¿™32æ”¯çƒé˜Ÿé‚£ä¸ªæ˜¯å† å†›ã€‚å¹¶ä¸”çŒœæµ‹é”™è¯¯ä»˜å‡ºä»£ä»·ã€‚æ¯çŒœé”™ä¸€æ¬¡ç»™ä¸€å—é’±ï¼Œå‘Šè¯‰æˆ‘æ˜¯å¦çŒœå¯¹äº†ï¼Œé‚£ä¹ˆæˆ‘éœ€è¦æå¤šå°‘é’±æ‰èƒ½çŸ¥é“è°æ˜¯å† å†›ï¼Ÿ ï¼ˆå‰ææ˜¯ï¼šä¸çŸ¥é“ä»»æ„çƒé˜Ÿçš„ä¿¡æ¯ã€å†å²æ¯”èµ›è®°å½•ã€å®åŠ›ç­‰ï¼‰

![image7cfda.png](https://miao.su/images/2019/07/06/image7cfda.png)

**ä¸ºäº†ä½¿ä»£ä»·æœ€å°ï¼Œå¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•çŒœæµ‹ï¼š**

æˆ‘å¯ä»¥æŠŠçƒç¼–ä¸Šå·ï¼Œä»1åˆ°32ï¼Œç„¶åæé—®ï¼šå†  å†›åœ¨1-16å·å—ï¼Ÿä¾æ¬¡è¯¢é—®ï¼Œåªéœ€è¦äº”æ¬¡ï¼Œå°±å¯ä»¥çŸ¥é“ç»“æœã€‚
![image45da4.png](https://miao.su/images/2019/07/06/image45da4.png)

æˆ‘ä»¬æ¥çœ‹è¿™ä¸ªå¼å­ï¼š

* 32æ”¯çƒé˜Ÿï¼Œ$log_232=5$
* 64æ”¯çƒé˜Ÿï¼Œ$log_264=6$

![image342d9.png](https://miao.su/images/2019/07/06/image342d9.png)

**é¦™å†œæŒ‡å‡ºï¼Œå®ƒçš„å‡†ç¡®ä¿¡æ¯é‡åº”è¯¥æ˜¯ï¼Œpä¸ºæ¯ä¸ªçƒé˜Ÿè·èƒœçš„æ¦‚ç‡ï¼ˆå‡è®¾æ¦‚ç‡ç›¸ç­‰ï¼Œéƒ½ä¸º1/32ï¼‰ï¼Œ æˆ‘ä»¬ä¸ç”¨é’±å»è¡¡é‡è¿™ä¸ªä»£ä»·äº†ï¼Œé¦™å†œæŒ‡å‡ºç”¨æ¯”ç‰¹ï¼š**
$$
H=-(p_1log_2p_1+p_2log_2p_2+p_3log_2p_3+...+p_{32}log_2p_{32})=-log_232
$$

#### ä¿¡æ¯ç†µçš„å®šä¹‰

* $H$ çš„ä¸“ä¸šæœ¯è¯­ç§°ä¹‹ä¸ºä¿¡æ¯ç†µï¼Œå•ä½ä¸ºæ¯”ç‰¹ã€‚

$$
H=-\displaystyle\sum_{i=1}^np(x_i)log_2p(x_i)
$$

* â€œè°æ˜¯ä¸–ç•Œæ¯å† å†›â€çš„æ¦‚ç‡ç›¸åŒï¼Œåˆ™ç»“æœä¸º5bit
* åªè¦æœ‰ä¸€ä¸ªå…ƒç´ ä¸åŒï¼Œé‚£ä¹ˆè¿™ä¸ªç»“æœå°±ä¸€å®šå°äº5bit
* å³ï¼Œåªè¦æ¦‚ç‡å‘ç”Ÿå˜åŒ–ï¼Œä¿¡æ¯ç†µéƒ½æ¯”5bitå°

#### æ€»ç»“ï¼ˆé‡è¦ï¼‰

* **ä¿¡æ¯ç†µå’Œæ¶ˆé™¤ä¸ç¡®å®šæ€§æ˜¯ç›¸è”ç³»çš„**
  å½“æˆ‘ä»¬å¾—åˆ°é¢å¤–ä¿¡æ¯ï¼ˆçƒé˜Ÿå†å²æ¯”èµ›æƒ…å†µç­‰ç­‰ï¼‰è¶Šå¤šçš„è¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬çŒœæµ‹çš„ä»£ä»·è¶Šå°ï¼ˆçŒœæµ‹çš„ä¸ç¡®å®šæ€§å‡å°ï¼‰
* *é—®é¢˜ï¼šå›åˆ°æˆ‘ä»¬å‰é¢çš„è´·æ¬¾æ¡ˆä¾‹ï¼Œæ€ä¹ˆå»åˆ’åˆ†ï¼Ÿå¯ä»¥åˆ©ç”¨å½“å¾—çŸ¥æŸä¸ªç‰¹å¾ï¼ˆæ¯”å¦‚æ˜¯å¦æœ‰æˆ¿å­ï¼‰ä¹‹åï¼Œæˆ‘ä»¬èƒ½å¤Ÿå‡å°‘çš„ä¸ç¡®å®šæ€§å¤§å°ï¼Œè¶Šå¤§æˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿™ä¸ªç‰¹å¾å¾ˆé‡è¦ã€‚é‚£æ€ä¹ˆå»è¡¡é‡å‡å°‘çš„ä¸ç¡®å®šæ€§å¤§å°å‘¢ï¼Ÿ*

### å†³ç­–æ ‘çš„åˆ’åˆ†ä¾æ®ä¹‹ä¸€â€”â€”ä¿¡æ¯å¢ç›Š

#### å®šä¹‰ä¸å…¬å¼

ç‰¹å¾Aå¯¹è®­ç»ƒæ•°æ®é›†Dçš„ä¿¡æ¯å¢ç›Š`g(D, A)`ï¼Œå®šä¹‰ä¸ºé›†åˆDçš„ä¿¡æ¯ç†µ`H(D)`ä¸ç‰¹å¾Aç»™å®šæ¡ä»¶ä¸‹Dçš„ä¿¡æ¯æ¡ä»¶ç†µ`H(D|A)`ä¹‹å·®ï¼Œå³å…¬å¼ä¸ºï¼š
$$
g(D,A)=H(D)-H(D|A)
$$
å…¬å¼çš„è¯¦ç»†è§£é‡Šï¼š
![image222c1.png](https://miao.su/images/2019/07/08/image222c1.png)

æ³¨ï¼šä¿¡æ¯å¢ç›Šè¡¨ç¤ºå¾—çŸ¥ç‰¹å¾Xçš„ä¿¡æ¯è€Œä½¿å¾—ç±»Yçš„ä¿¡æ¯ç†µå‡å°‘çš„ç¨‹åº¦

#### è´·æ¬¾ç‰¹å¾é‡è¦è®¡ç®—

![imageb30c7.png](https://miao.su/images/2019/07/06/imageb30c7.png)

* æˆ‘ä»¬ä»¥å¹´é¾„ä¸ºç‰¹å¾æ¥è®¡ç®—ï¼š

  ```markdown
  1ã€g(D, å¹´é¾„) = H(D) -H(D|å¹´é¾„) = 0.971-[5/15H(é’å¹´)+5/15H(ä¸­å¹´)+5/15H(è€å¹´]
  
  2ã€H(D) = -(6/15log(6/15)+9/15log(9/15))=0.971
  
  3ã€H(é’å¹´) = -(3/5log(3/5) +2/5log(2/5))
  H(ä¸­å¹´)=-(3/5log(3/5) +2/5log(2/5))
  H(è€å¹´)=-(4/5og(4/5)+1/5log(1/5))
  ```

  æˆ‘ä»¬ä»¥A1ã€A2ã€A3ã€A4ä»£è¡¨å¹´é¾„ã€æœ‰å·¥ä½œã€æœ‰è‡ªå·±çš„æˆ¿å­å’Œè´·æ¬¾æƒ…å†µã€‚æœ€ç»ˆè®¡ç®—çš„ç»“æœg(D, A1) = 0.313, g(D, A2) = 0.324, g(D, A3) = 0.420,g(D, A4) = 0.363ã€‚æ‰€ä»¥æˆ‘ä»¬é€‰æ‹©A3 ä½œä¸ºåˆ’åˆ†çš„ç¬¬ä¸€ä¸ªç‰¹å¾ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸€æ£µæ ‘æ…¢æ…¢å»ºç«‹

### å†³ç­–æ ‘çš„ä¸‰ç§ç®—æ³•å®ç°

å½“ç„¶å†³ç­–æ ‘çš„åŸç†ä¸æ­¢ä¿¡æ¯å¢ç›Šè¿™ä¸€ç§ï¼Œè¿˜æœ‰å…¶ä»–æ–¹æ³•ã€‚ä½†æ˜¯åŸç†éƒ½ç±»ä¼¼ï¼Œæˆ‘ä»¬å°±ä¸å»ä¸¾ä¾‹è®¡ç®—ã€‚

* ID3
  * ä¿¡æ¯å¢ç›Šæœ€å¤§å‡†åˆ™
* C4.5
  * ä¿¡æ¯å¢ç›Šæ¯” æœ€å¤§çš„å‡†åˆ™
* CART
  * åˆ†ç±»æ ‘ï¼šåŸºå°¼ç³»æ•° æœ€å°çš„å‡†åˆ™ åœ¨sklearnä¸­å¯ä»¥é€‰æ‹©åˆ’åˆ†çš„é»˜è®¤åŸåˆ™
  * ä¼˜åŠ¿ï¼šåˆ’åˆ†æ›´åŠ ç»†è‡´ï¼ˆä»åé¢ä¾‹å­çš„æ ‘æ˜¾ç¤ºæ¥ç†è§£ï¼‰

### å†³ç­–æ ‘API

- `class sklearn.tree.DecisionTreeClassifier(criterion=â€™giniâ€™, max_depth=None,random_state=None)`
  - å†³ç­–æ ‘åˆ†ç±»å™¨
  - `criterion`:é»˜è®¤æ˜¯`gini`ç³»æ•°ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¿¡æ¯å¢ç›Šçš„ç†µ`entropy`
  - `max_depth`:æ ‘çš„æ·±åº¦å¤§å°
  - `random_state`:éšæœºæ•°ç§å­
- å…¶ä¸­ä¼šæœ‰äº›**è¶…å‚æ•°ï¼šmax_depth:æ ‘çš„æ·±åº¦å¤§å°**
  - å…¶å®ƒè¶…å‚æ•°æˆ‘ä»¬ä¼šç»“åˆéšæœºæ£®æ—è®²è§£

### æ¡ˆä¾‹ï¼šæ³°å¦å°¼å…‹å·ä¹˜å®¢ç”Ÿå­˜é¢„æµ‹

- æ³°å¦å°¼å…‹å·æ•°æ®

åœ¨æ³°å¦å°¼å…‹å·å’Œtitanicæ•°æ®å¸§æè¿°æ³°å¦å°¼å…‹å·ä¸Šçš„ä¸ªåˆ«ä¹˜å®¢çš„ç”Ÿå­˜çŠ¶æ€ã€‚è¿™é‡Œä½¿ç”¨çš„æ•°æ®é›†æ˜¯ç”±å„ç§ç ”ç©¶äººå‘˜å¼€å§‹çš„ã€‚å…¶ä¸­åŒ…æ‹¬è®¸å¤šç ”ç©¶äººå‘˜åˆ›å»ºçš„æ—…å®¢åå•ï¼Œç”±Michael A. Findlayç¼–è¾‘ã€‚æˆ‘ä»¬æå–çš„æ•°æ®é›†ä¸­çš„ç‰¹å¾æ˜¯ç¥¨çš„ç±»åˆ«ï¼Œå­˜æ´»ï¼Œä¹˜åç­ï¼Œå¹´é¾„ï¼Œç™»é™†ï¼Œhome.destï¼Œæˆ¿é—´ï¼Œç¥¨ï¼Œèˆ¹å’Œæ€§åˆ«ã€‚

1. **ä¹˜åç­æ˜¯æŒ‡ä¹˜å®¢ç­ï¼ˆ1ï¼Œ2ï¼Œ3ï¼‰ï¼Œæ˜¯ç¤¾ä¼šç»æµé˜¶å±‚çš„ä»£è¡¨**
2. **å…¶ä¸­ageæ•°æ®å­˜åœ¨ç¼ºå¤±**

*æ•°æ®ï¼šhttp://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/titanic.txt*

#### åˆ†æ

- é€‰æ‹©æˆ‘ä»¬è®¤ä¸ºé‡è¦çš„å‡ ä¸ªç‰¹å¾ ['pclass', 'age', 'sex']
- å¡«å……ç¼ºå¤±å€¼
- ç‰¹å¾ä¸­å‡ºç°ç±»åˆ«ç¬¦å·ï¼Œéœ€è¦è¿›è¡Œone-hotç¼–ç å¤„ç†(DictVectorizer)
  - x.to_dict(orient="records") éœ€è¦å°†æ•°ç»„ç‰¹å¾è½¬æ¢æˆå­—å…¸æ•°æ®
- æ•°æ®é›†åˆ’åˆ†
- å†³ç­–æ ‘åˆ†ç±»é¢„æµ‹

#### ä»£ç 

```python
#!/usr/bin/env python
# coding=utf-8
from sklearn.feature_extraction import DictVectorizer
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.tree import DecisionTreeClassifier, export_graphviz


def decision():
    """å†³ç­–æ ‘é¢„æµ‹ä¹˜å®¢ç”Ÿå­˜åˆ†ç±»"""
    # 1.è·å–ä¹˜å®¢çš„æ•°æ®
    titan = pd.read_csv("http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/titanic.txt")
    # 2.ç¡®å®šç‰¹å¾å€¼å’Œç›®æ ‡å€¼ï¼Œç¼ºå¤±å€¼å¤„ç†ï¼Œç‰¹å¾ç±»åˆ«æ•°æ®-->one-hotç¼–ç 
    # å–å‡ºç‰¹å¾å€¼
    x = titan[['pclass', 'age', 'sex']]
    # å–å‡ºç›®æ ‡å€¼
    y = titan['survived']
    # å¡«å……ç¼ºå¤±å€¼
    x['age'].fillna(x['age'].mean(), inplace=True)
    # ç‰¹å¾ç±»åˆ«æ•°æ®-->one-hotç¼–ç 
    dic= DictVectorizer(sparse=False)
    # è½¬æ¢ç¤ºä¾‹ï¼š[["1st","2","female"],[]]--->[{"pclass":, "age":2, "sex: female"}, ]
    x = dic.fit_transform(x.to_dict(orient="records"))
    print(dic.get_feature_names())
    print(x)
    # 3ã€åˆ†å‰²æ•°æ®é›†
    x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3)

    # 4ã€å†³ç­–æ ‘è¿›è¡Œé¢„æµ‹
    dec = DecisionTreeClassifier(max_depth=5)
    #
    dec.fit(x_train, y_train)
    #
    print("é¢„æµ‹çš„å‡†ç¡®ç‡ä¸ºï¼š", dec.score(x_test, y_test))

    # å¯¼å‡ºåˆ°dotæ–‡ä»¶
    export_graphviz(dec, out_file="./test.dot", feature_names=['age', 'pclass=1st', 'pclass=2nd', 'pclass=3rd', 'å¥³æ€§', 'ç”·æ€§'])


if __name__ == '__main__':
    decision()
```

*ç”±äºå†³ç­–æ ‘ç±»ä¼¼ä¸€ä¸ªæ ‘çš„ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ä¿å­˜åˆ°æœ¬åœ°æ˜¾ç¤º*

### ä¿å­˜æ ‘çš„ç»“æ„åˆ°dotæ–‡ä»¶

- 1ã€`sklearn.tree.export_graphviz()`è¯¥å‡½æ•°èƒ½å¤Ÿå¯¼å‡ºDOTæ ¼å¼
  - tree.export_graphviz(estimator,out_file='tree.dotâ€™,feature_names=[â€˜â€™,â€™â€™])
- 2ã€å·¥å…·:(èƒ½å¤Ÿå°†dotæ–‡ä»¶è½¬æ¢ä¸ºpdfã€png)
  - å®‰è£…graphviz
  - ubuntu: sudo apt-get install graphviz Mac:brew install graphviz
- 3ã€è¿è¡Œå‘½ä»¤
  - ç„¶åæˆ‘ä»¬è¿è¡Œè¿™ä¸ªå‘½ä»¤
  - dot -Tpng tree.dot -o tree.png

```python
export_graphviz(dc, out_file="./tree.dot", feature_names=['age', 'pclass=1st', 'pclass=2nd', 'pclass=3rd', 'å¥³æ€§', 'ç”·æ€§'])
```

### å†³ç­–æ ‘æ€»ç»“

- ä¼˜ç‚¹ï¼š
  - ç®€å•çš„ç†è§£å’Œè§£é‡Šï¼Œæ ‘æœ¨å¯è§†åŒ–ã€‚
- ç¼ºç‚¹ï¼š
  - å†³ç­–æ ‘å­¦ä¹ è€…å¯ä»¥åˆ›å»ºä¸èƒ½å¾ˆå¥½åœ°æ¨å¹¿æ•°æ®çš„è¿‡äºå¤æ‚çš„æ ‘ï¼Œè¿™è¢«ç§°ä¸º**è¿‡æ‹Ÿåˆ**ã€‚
- æ”¹è¿›ï¼š
  - å‡æcartç®—æ³•(å†³ç­–æ ‘APIå½“ä¸­å·²ç»å®ç°ï¼Œéšæœºæ£®æ—å‚æ•°è°ƒä¼˜æœ‰ç›¸å…³ä»‹ç»)
  - **éšæœºæ£®æ—**

*æ³¨ï¼šä¼ä¸šé‡è¦å†³ç­–ï¼Œç”±äºå†³ç­–æ ‘å¾ˆå¥½çš„åˆ†æèƒ½åŠ›ï¼Œåœ¨å†³ç­–è¿‡ç¨‹åº”ç”¨è¾ƒå¤šï¼Œ å¯ä»¥é€‰æ‹©ç‰¹å¾*

## é›†æˆå­¦ä¹ æ–¹æ³•ä¹‹éšæœºæ£®æ—

### ä»€ä¹ˆæ˜¯é›†æˆå­¦ä¹ æ–¹æ³•

é›†æˆå­¦ä¹ é€šè¿‡å»ºç«‹å‡ ä¸ªæ¨¡å‹ç»„åˆçš„æ¥è§£å†³å•ä¸€é¢„æµ‹é—®é¢˜ã€‚å®ƒçš„å·¥ä½œåŸç†æ˜¯**ç”Ÿæˆå¤šä¸ªåˆ†ç±»å™¨/æ¨¡å‹**ï¼Œå„è‡ªç‹¬ç«‹åœ°å­¦ä¹ å’Œä½œå‡ºé¢„æµ‹ã€‚*è¿™äº›é¢„æµ‹æœ€åç»“åˆæˆç»„åˆé¢„æµ‹ï¼Œå› æ­¤ä¼˜äºä»»ä½•ä¸€ä¸ªå•åˆ†ç±»çš„åšå‡ºé¢„æµ‹ã€‚*

### ä»€ä¹ˆæ˜¯éšæœºæ£®æ—

åœ¨æœºå™¨å­¦ä¹ ä¸­ï¼Œ**éšæœºæ£®æ—æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå†³ç­–æ ‘çš„åˆ†ç±»å™¨**ï¼Œå¹¶ä¸”å…¶è¾“å‡ºçš„ç±»åˆ«æ˜¯ç”±ä¸ªåˆ«æ ‘è¾“å‡ºçš„ç±»åˆ«çš„ä¼—æ•°è€Œå®šã€‚
*ä¾‹å¦‚, å¦‚æœä½ è®­ç»ƒäº†5ä¸ªæ ‘, å…¶ä¸­æœ‰4ä¸ªæ ‘çš„ç»“æœæ˜¯True, 1ä¸ªæ•°çš„ç»“æœæ˜¯False, é‚£ä¹ˆæœ€ç»ˆæŠ•ç¥¨ç»“æœå°±æ˜¯True*

### éšæœºæ£®æ—ç”Ÿæˆçš„è¿‡ç¨‹

æ ¹æ®ä¸‹åˆ—ç®—æ³•è€Œå»ºé€ æ¯æ£µæ ‘ï¼š

- ç”¨Næ¥è¡¨ç¤ºè®­ç»ƒç”¨ä¾‹ï¼ˆæ ·æœ¬ï¼‰çš„ä¸ªæ•°ï¼ŒMè¡¨ç¤ºç‰¹å¾æ•°ç›®ã€‚
  - 1ã€ä¸€æ¬¡éšæœºé€‰å‡ºä¸€ä¸ªæ ·æœ¬ï¼Œé‡å¤Næ¬¡ï¼Œ ï¼ˆæœ‰å¯èƒ½å‡ºç°é‡å¤çš„æ ·æœ¬ï¼‰
  - 2ã€éšæœºå»é€‰å‡ºmä¸ªç‰¹å¾, m <<Mï¼Œå»ºç«‹å†³ç­–æ ‘
- é‡‡å–bootstrapæŠ½æ ·

### ä¸ºä»€ä¹ˆé‡‡ç”¨BootStrapæŠ½æ ·

- ä¸ºä»€ä¹ˆè¦éšæœºæŠ½æ ·è®­ç»ƒé›†ï¼Ÿã€€ã€€
  - å¦‚æœä¸è¿›è¡ŒéšæœºæŠ½æ ·ï¼Œæ¯æ£µæ ‘çš„è®­ç»ƒé›†éƒ½ä¸€æ ·ï¼Œé‚£ä¹ˆæœ€ç»ˆè®­ç»ƒå‡ºçš„æ ‘åˆ†ç±»ç»“æœä¹Ÿæ˜¯å®Œå…¨ä¸€æ ·çš„
- ä¸ºä»€ä¹ˆè¦æœ‰æ”¾å›åœ°æŠ½æ ·ï¼Ÿ
  - å¦‚æœä¸æ˜¯æœ‰æ”¾å›çš„æŠ½æ ·ï¼Œé‚£ä¹ˆæ¯æ£µæ ‘çš„è®­ç»ƒæ ·æœ¬éƒ½æ˜¯ä¸åŒçš„ï¼Œéƒ½æ˜¯æ²¡æœ‰äº¤é›†çš„ï¼Œè¿™æ ·æ¯æ£µæ ‘éƒ½æ˜¯â€œæœ‰åçš„â€ï¼Œéƒ½æ˜¯ç»å¯¹â€œç‰‡é¢çš„â€ï¼ˆå½“ç„¶è¿™æ ·è¯´å¯èƒ½ä¸å¯¹ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ£µæ ‘è®­ç»ƒå‡ºæ¥éƒ½æ˜¯æœ‰å¾ˆå¤§çš„å·®å¼‚çš„ï¼›è€Œéšæœºæ£®æ—æœ€ååˆ†ç±»å–å†³äºå¤šæ£µæ ‘ï¼ˆå¼±åˆ†ç±»å™¨ï¼‰çš„æŠ•ç¥¨è¡¨å†³ã€‚

### API

- class sklearn.ensemble.RandomForestClassifier(n_estimators=10, criterion=â€™giniâ€™, max_depth=None, bootstrap=True, random_state=None, min_samples_split=2)
  - éšæœºæ£®æ—åˆ†ç±»å™¨
  - n_estimatorsï¼š integerï¼Œoptionalï¼ˆdefault = 10ï¼‰æ£®æ—é‡Œçš„æ ‘æœ¨æ•°é‡120,200,300,500,800,1200
  - criteriaï¼š stringï¼Œå¯é€‰ï¼ˆdefault =â€œginiâ€ï¼‰åˆ†å‰²ç‰¹å¾çš„æµ‹é‡æ–¹æ³•
  - max_depthï¼š integeræˆ–Noneï¼Œå¯é€‰ï¼ˆé»˜è®¤=æ— ï¼‰æ ‘çš„æœ€å¤§æ·±åº¦ 5,8,15,25,30
  - max_features="autoâ€,æ¯ä¸ªå†³ç­–æ ‘çš„æœ€å¤§ç‰¹å¾æ•°é‡
    - If "auto", then `max_features=sqrt(n_features)`.
    - If "sqrt", then `max_features=sqrt(n_features)` (same as "auto").
    - If "log2", then `max_features=log2(n_features)`.
    - If None, then `max_features=n_features`.
  - bootstrapï¼š booleanï¼Œoptionalï¼ˆdefault = Trueï¼‰æ˜¯å¦åœ¨æ„å»ºæ ‘æ—¶ä½¿ç”¨æ”¾å›æŠ½æ ·
  - min_samples_split:èŠ‚ç‚¹åˆ’åˆ†æœ€å°‘æ ·æœ¬æ•°
  - min_samples_leaf:å¶å­èŠ‚ç‚¹çš„æœ€å°æ ·æœ¬æ•°

- è¶…å‚æ•°ï¼šn_estimator, max_depth, min_samples_split,min_samples_leaf

### æ³°å¦å°¼å…‹å†ç°ä»£ç 

```python
#!/usr/bin/env python
# coding=utf-8
from sklearn.feature_extraction import DictVectorizer
import pandas as pd
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.tree import DecisionTreeClassifier, export_graphviz
from sklearn.ensemble import RandomForestClassifier


def decision():
    """å†³ç­–æ ‘é¢„æµ‹ä¹˜å®¢ç”Ÿå­˜åˆ†ç±»"""
    # 1.è·å–ä¹˜å®¢çš„æ•°æ®
    titan = pd.read_csv("http://biostat.mc.vanderbilt.edu/wiki/pub/Main/DataSets/titanic.txt")
    # 2.ç¡®å®šç‰¹å¾å€¼å’Œç›®æ ‡å€¼ï¼Œç¼ºå¤±å€¼å¤„ç†ï¼Œç‰¹å¾ç±»åˆ«æ•°æ®-->one-hotç¼–ç 
    # å–å‡ºç‰¹å¾å€¼
    x = titan[['pclass', 'age', 'sex']]
    # å–å‡ºç›®æ ‡å€¼
    y = titan['survived']
    # å¡«å……ç¼ºå¤±å€¼
    x['age'].fillna(x['age'].mean(), inplace=True)
    # ç‰¹å¾ç±»åˆ«æ•°æ®-->one-hotç¼–ç 
    dic= DictVectorizer(sparse=False)
    # è½¬æ¢ç¤ºä¾‹ï¼š[["1st","2","female"],[]]--->[{"pclass":, "age":2, "sex: female"}, ]
    x = dic.fit_transform(x.to_dict(orient="records"))
    print(dic.get_feature_names())
    print(x)
    # 3ã€åˆ†å‰²æ•°æ®é›†
    x_train, x_test, y_train, y_test = train_test_split(x, y, test_size=0.3)

    # 4ã€å†³ç­–æ ‘è¿›è¡Œé¢„æµ‹
    # dec = DecisionTreeClassifier(max_depth=5)

    # dec.fit(x_train, y_train)

    # print("é¢„æµ‹çš„å‡†ç¡®ç‡ä¸ºï¼š", dec.score(x_test, y_test))

    # å¯¼å‡ºåˆ°dotæ–‡ä»¶
    # export_graphviz(dec, out_file="./test.dot",
    # feature_names=['age', 'pclass=1st', 'pclass=2nd', 'pclass=3rd', 'å¥³æ€§', 'ç”·æ€§'])

    # 5.éšæœºæ£®æ—è¿›è¡Œé¢„æµ‹
    # å®ä¾‹åŒ–
    rdtree = RandomForestClassifier()

    # æ„é€ è¶…å‚æ•°çš„å­—å…¸
    param = {"n_estimators":[120, 200],
             "max_depth": [5, 8],
             "min_samples_split": [2, 3]}
    gc = GridSearchCV(rdtree, param_grid=param, cv=2)
    gc.fit(x_train, y_train)
    print("éšæœºæ£®æ—çš„å‡†ç¡®ç‡:", gc.score(x_test, y_test))
    print("äº¤å‰éªŒè¯é€‰æ‹©çš„å‚æ•°:", gc.best_estimator_)
    return None


if __name__ == '__main__':
    decision()
```

### æ€»ç»“

- åœ¨å½“å‰æ‰€æœ‰ç®—æ³•ä¸­ï¼Œå…·æœ‰æå¥½çš„å‡†ç¡®ç‡
- èƒ½å¤Ÿæœ‰æ•ˆåœ°è¿è¡Œåœ¨å¤§æ•°æ®é›†ä¸Šï¼Œå¤„ç†å…·æœ‰é«˜ç»´ç‰¹å¾çš„è¾“å…¥æ ·æœ¬ï¼Œè€Œä¸”ä¸éœ€è¦é™ç»´
- èƒ½å¤Ÿè¯„ä¼°å„ä¸ªç‰¹å¾åœ¨åˆ†ç±»é—®é¢˜ä¸Šçš„é‡è¦æ€§